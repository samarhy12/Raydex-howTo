{% extends "base.html" %} {% block title %}Edit Post - Raydex Admin{% endblock
%} {% block content %}
<div class="min-h-screen py-12 pb-20">
  <div class="max-w-4xl mx-auto px-6 md:px-8">
    <header class="pb-8 mb-12 border-b-2 border-border">
      <h1 class="font-serif text-4xl md:text-5xl font-bold text-ink mb-2">
        Edit Post
      </h1>
      <p class="text-base text-ink-soft">Update your article content</p>
    </header>
    <div class="bg-surface border border-border rounded-xl p-8">
      <form id="editForm" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-ink mb-2">Title</label
          ><input
            type="text"
            id="title"
            required
            class="w-full px-4 py-3.5 border border-border rounded-lg"
            value="{{ post.title }}"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-ink mb-2">Subtitle</label
          ><input
            type="text"
            id="subtitle"
            class="w-full px-4 py-3.5 border border-border rounded-lg"
            value="{{ post.subtitle or '' }}"
          />
        </div>
        <div id="contentContainer"></div>
        <button
          type="submit"
          id="submitBtn"
          class="w-full py-4 bg-accent text-surface rounded-lg font-medium hover:bg-accent-soft"
        >
          <span id="submitText">Update Post</span
          ><span id="loadingText" class="hidden">Updating...</span>
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  const postData = {{ post.to_dict() | tojson }};

  // Check authentication on page load
  document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      const userStr = localStorage.getItem('user');

      if (!token || !userStr) {
          window.location.href = '/login';
          return;
      }

      try {
          const user = JSON.parse(userStr);
          if (user.role !== 'admin') {
              window.location.href = '/dashboard';
              return;
          }
      } catch (e) {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/login';
          return;
      }

      // Load post content
      const container = document.getElementById('contentContainer');
      postData.content.forEach((block, i) => {
          if (block.type === 'text') {
              container.innerHTML += `<div class="mb-4"><label class="block text-sm font-medium text-ink mb-2">Text Block ${i + 1}</label><textarea class="w-full px-4 py-3.5 border border-border rounded-lg resize-none" rows="4" data-block-type="text">${block.data}</textarea></div>`;
          } else if (block.type === 'image') {
              container.innerHTML += `<div class="mb-4"><label class="block text-sm font-medium text-ink mb-2">Image Block ${i + 1}</label><img src="/static/uploads/${block.data}" class="w-full mb-2 rounded-lg"><input type="text" class="w-full px-4 py-3.5 border border-border rounded-lg" data-caption="${i}" value="${block.caption || ''}" placeholder="Caption"></div>`;
          }
      });
  });

  document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      showToast('Edit functionality requires full backend integration', 'info');
  });
</script>
{% endblock %}
