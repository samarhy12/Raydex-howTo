{% extends "base.html" %} {% block title %}Request Custom Guide - Raydex{%
endblock %} {% block content %}
<div class="min-h-screen py-12 pb-20">
  <div class="max-w-3xl mx-auto px-6 md:px-8">
    <header class="pb-8 mb-12 border-b-2 border-border text-center">
      <div
        class="inline-flex items-center gap-2 px-4 py-2 bg-accent-light border border-accent/20 rounded-full text-sm font-medium text-accent mb-6"
      >
        <i data-lucide="sparkles" class="w-4 h-4"></i>Custom Guide Request
      </div>
      <h1 class="font-serif text-4xl md:text-5xl font-bold text-ink mb-4">
        Request Your Custom How-To Guide
      </h1>
      <p class="text-base text-ink-soft max-w-2xl mx-auto">
        Tell us what you want to learn, and we'll create a comprehensive guide
        tailored to your needs. Delivery within 48 hours.
      </p>
    </header>
    <div class="bg-surface border border-border rounded-xl p-8 shadow-lg">
      <form id="requestForm" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-ink mb-2"
            >Guide Title <span class="text-error">*</span></label
          ><input
            type="text"
            id="title"
            required
            class="w-full px-4 py-3.5 border border-border rounded-lg"
            placeholder="e.g., How to Build a REST API with Flask"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-ink mb-2"
            >Category <span class="text-error">*</span></label
          ><select
            id="category"
            required
            class="w-full px-4 py-3.5 border border-border rounded-lg"
          >
            <option value="">Select a category</option>
            <option value="Web Development">Web Development</option>
            <option value="Mobile Development">Mobile Development</option>
            <option value="Data Science">Data Science</option>
            <option value="DevOps">DevOps</option>
            <option value="Design">Design</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-ink mb-2"
            >Priority <span class="text-error">*</span></label
          >
          <div class="flex gap-4">
            <label class="flex items-center gap-2"
              ><input
                type="radio"
                name="priority"
                value="low"
                class="w-4 h-4"
              /><span class="text-sm">Low</span></label
            ><label class="flex items-center gap-2"
              ><input
                type="radio"
                name="priority"
                value="medium"
                checked
                class="w-4 h-4"
              /><span class="text-sm">Medium</span></label
            ><label class="flex items-center gap-2"
              ><input
                type="radio"
                name="priority"
                value="high"
                class="w-4 h-4"
              /><span class="text-sm">High</span></label
            >
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-ink mb-2"
            >Description <span class="text-error">*</span></label
          ><textarea
            id="description"
            required
            rows="6"
            class="w-full px-4 py-3.5 border border-border rounded-lg resize-none"
            placeholder="Describe what you want to learn in detail..."
          ></textarea>
        </div>
        <button
          type="submit"
          id="submitBtn"
          class="w-full py-4 bg-accent text-surface rounded-lg font-medium hover:bg-accent-soft transition-all"
        >
          <span id="submitText">Submit Request</span
          ><span id="loadingText" class="hidden">Submitting...</span>
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Check authentication on page load
  document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("token");
    const userStr = localStorage.getItem("user");

    if (!token || !userStr) {
      window.location.href = "/login";
      return;
    }

    try {
      const user = JSON.parse(userStr);
      // Admin should use admin panel, not user request form
      if (user.role === "admin") {
        window.location.href = "/admin/dashboard";
        return;
      }
    } catch (e) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      window.location.href = "/login";
      return;
    }
  });

  document
    .getElementById("requestForm")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const btn = document.getElementById("submitBtn");
      const submitText = document.getElementById("submitText");
      const loadingText = document.getElementById("loadingText");

      const token = localStorage.getItem("token");
      if (!token) {
        showToast("Please log in first", "error");
        window.location.href = "/login";
        return;
      }

      btn.disabled = true;
      submitText.classList.add("hidden");
      loadingText.classList.remove("hidden");

      try {
        const response = await fetch("/api/requests", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({
            title: document.getElementById("title").value,
            category: document.getElementById("category").value,
            priority: document.querySelector('input[name="priority"]:checked')
              .value,
            description: document.getElementById("description").value,
          }),
        });

        const data = await response.json();
        if (data.success) {
          showToast("Request submitted successfully!", "success");
          setTimeout(() => (window.location.href = "/dashboard"), 1000);
        } else {
          showToast(data.error || "Failed to submit request", "error");
          btn.disabled = false;
          submitText.classList.remove("hidden");
          loadingText.classList.add("hidden");
        }
      } catch (error) {
        console.error("Error:", error);
        showToast("An error occurred", "error");
        btn.disabled = false;
        submitText.classList.remove("hidden");
        loadingText.classList.add("hidden");
      }
    });
</script>
{% endblock %}
